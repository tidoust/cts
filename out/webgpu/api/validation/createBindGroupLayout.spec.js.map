{"version":3,"sources":["../../../../src/webgpu/api/validation/createBindGroupLayout.spec.ts"],"names":["description","pbool","poptions","params","makeTestGroup","kBindingTypeInfo","kBindingTypes","kBufferBindingTypeInfo","kMaxBindingsPerBindGroup","kShaderStages","kShaderStageCombinations","kTextureBindingTypeInfo","kTextureComponentTypes","kTextureViewDimensions","kTextureViewDimensionInfo","kAllTextureFormats","kAllTextureFormatInfo","ValidationTest","clone","descriptor","JSON","parse","stringify","g","test","fn","t","goodDescriptor","entries","binding","visibility","GPUShaderStage","COMPUTE","type","device","createBindGroupLayout","badDescriptor","expectValidationError","combine","success","validStages","_","hasDynamicOffset","minBufferBindingSize","textureComponentType","multisampled","viewDimension","storageTextureFormat","undefined","resource","storage","maxDynamicBufferCount","maxDynamicBufferBindings","i","push","length","pickExtraBindingTypes","bindingType","extraTypeSame","info","extraBindingType","perStageLimitClass","class","kCasesForMaxResourcesPerStageTests","filter","p","maxedType","maxedVisibility","expand","extraType","extraVisibility","maxedTypeInfo","maxedCount","max","extraTypeInfo","maxResourceBindings","newDescriptor","shouldError","goodLayout","createPipelineLayout","bindGroupLayouts","extraLayout","newBindingCountsTowardSamePerStageLimit","layoutExceedsPerStageLimit"],"mappings":"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","sourcesContent":["export const description = `\ncreateBindGroupLayout validation tests.\n`;\n\nimport { pbool, poptions, params } from '../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport {\n  kBindingTypeInfo,\n  kBindingTypes,\n  kBufferBindingTypeInfo,\n  kMaxBindingsPerBindGroup,\n  kShaderStages,\n  kShaderStageCombinations,\n  kTextureBindingTypeInfo,\n  kTextureComponentTypes,\n  kTextureViewDimensions,\n  kTextureViewDimensionInfo,\n  kAllTextureFormats,\n  kAllTextureFormatInfo,\n} from '../../capability_info.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nfunction clone<T extends GPUBindGroupLayoutDescriptor>(descriptor: T): T {\n  return JSON.parse(JSON.stringify(descriptor));\n}\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('some_binding_index_was_specified_more_than_once').fn(async t => {\n  const goodDescriptor = {\n    entries: [\n      { binding: 0, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' as const },\n      { binding: 1, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' as const },\n    ],\n  };\n\n  // Control case\n  t.device.createBindGroupLayout(goodDescriptor);\n\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.entries[1].binding = 0;\n\n  // Binding index 0 can't be specified twice.\n  t.expectValidationError(() => {\n    t.device.createBindGroupLayout(badDescriptor);\n  });\n});\n\ng.test('visibility')\n  .params(\n    params()\n      .combine(poptions('type', kBindingTypes))\n      .combine(poptions('visibility', kShaderStageCombinations))\n  )\n  .fn(async t => {\n    const { type, visibility } = t.params;\n\n    const success = (visibility & ~kBindingTypeInfo[type].validStages) === 0;\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout({\n        entries: [{ binding: 0, visibility, type }],\n      });\n    }, !success);\n  });\n\ng.test('bindingTypeSpecific_optional_members')\n  .params(\n    params()\n      .combine(poptions('type', kBindingTypes))\n      .combine([\n        // Case with every member set to `undefined`.\n        {\n          // Workaround for TS inferring the type of [ {}, ...x ] overly conservatively, as {}[].\n          _: 0,\n        },\n        // Cases with one member set.\n        ...pbool('hasDynamicOffset'),\n        ...poptions('minBufferBindingSize', [0, 4]),\n        ...poptions('textureComponentType', kTextureComponentTypes),\n        ...pbool('multisampled'),\n        ...poptions('viewDimension', kTextureViewDimensions),\n        ...poptions('storageTextureFormat', kAllTextureFormats),\n      ])\n  )\n  .fn(t => {\n    const {\n      type,\n      hasDynamicOffset,\n      minBufferBindingSize,\n      textureComponentType,\n      multisampled,\n      viewDimension,\n      storageTextureFormat,\n    } = t.params;\n\n    let success = true;\n    if (!(type in kBufferBindingTypeInfo)) {\n      if (hasDynamicOffset !== undefined) success = false;\n      if (minBufferBindingSize !== undefined) success = false;\n    }\n    if (!(type in kTextureBindingTypeInfo)) {\n      if (viewDimension !== undefined) success = false;\n    }\n    if (kBindingTypeInfo[type].resource !== 'sampledTex') {\n      if (textureComponentType !== undefined) success = false;\n      if (multisampled !== undefined) success = false;\n    }\n    if (kBindingTypeInfo[type].resource !== 'storageTex') {\n      if (storageTextureFormat !== undefined) success = false;\n    } else {\n      if (viewDimension !== undefined && !kTextureViewDimensionInfo[viewDimension].storage) {\n        success = false;\n      }\n      if (\n        storageTextureFormat !== undefined &&\n        !kAllTextureFormatInfo[storageTextureFormat].storage\n      ) {\n        success = false;\n      }\n    }\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout({\n        entries: [\n          {\n            binding: 0,\n            visibility: GPUShaderStage.COMPUTE,\n            type,\n            hasDynamicOffset,\n            minBufferBindingSize,\n            textureComponentType,\n            multisampled,\n            viewDimension,\n            storageTextureFormat,\n          },\n        ],\n      });\n    }, !success);\n  });\n\ng.test('multisample_requires_2d_view_dimension')\n  .params(\n    params()\n      .combine(poptions('multisampled', [undefined, false, true]))\n      .combine(poptions('viewDimension', [undefined, ...kTextureViewDimensions]))\n  )\n  .fn(async t => {\n    const { multisampled, viewDimension } = t.params;\n\n    const success = multisampled !== true || viewDimension === '2d' || viewDimension === undefined;\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout({\n        entries: [\n          {\n            binding: 0,\n            visibility: GPUShaderStage.COMPUTE,\n            type: 'sampled-texture',\n            multisampled,\n            viewDimension,\n          },\n        ],\n      });\n    }, !success);\n  });\n\ng.test('number_of_dynamic_buffers_exceeds_the_maximum_value')\n  .params([\n    { type: 'storage-buffer' as const, maxDynamicBufferCount: 4 },\n    { type: 'uniform-buffer' as const, maxDynamicBufferCount: 8 },\n  ])\n  .fn(async t => {\n    const { type, maxDynamicBufferCount } = t.params;\n\n    const maxDynamicBufferBindings: GPUBindGroupLayoutEntry[] = [];\n    for (let i = 0; i < maxDynamicBufferCount; i++) {\n      maxDynamicBufferBindings.push({\n        binding: i,\n        visibility: GPUShaderStage.COMPUTE,\n        type,\n        hasDynamicOffset: true,\n      });\n    }\n\n    const goodDescriptor = {\n      entries: [\n        ...maxDynamicBufferBindings,\n        {\n          binding: maxDynamicBufferBindings.length,\n          visibility: GPUShaderStage.COMPUTE,\n          type,\n          hasDynamicOffset: false,\n        },\n      ],\n    };\n\n    // Control case\n    t.device.createBindGroupLayout(goodDescriptor);\n\n    // Dynamic buffers exceed maximum in a bind group layout.\n    const badDescriptor = clone(goodDescriptor);\n    badDescriptor.entries[maxDynamicBufferCount].hasDynamicOffset = true;\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout(badDescriptor);\n    });\n  });\n\n// One bind group layout will be filled with kPerStageBindingLimit[...] of the type |type|.\n// For each item in the array returned here, a case will be generated which tests a pipeline\n// layout with one extra bind group layout with one extra binding. That extra binding will have:\n//\n//   - If extraTypeSame, any of the binding types which counts toward the same limit as |type|.\n//     (i.e. 'storage-buffer' <-> 'readonly-storage-buffer').\n//   - Otherwise, an arbitrary other type.\nfunction* pickExtraBindingTypes(\n  bindingType: GPUBindingType,\n  extraTypeSame: boolean\n): IterableIterator<GPUBindingType> {\n  const info = kBindingTypeInfo[bindingType];\n  if (extraTypeSame) {\n    for (const extraBindingType of kBindingTypes) {\n      if (\n        info.perStageLimitClass.class ===\n        kBindingTypeInfo[extraBindingType].perStageLimitClass.class\n      ) {\n        yield extraBindingType;\n      }\n    }\n  } else {\n    yield info.perStageLimitClass.class === 'sampler' ? 'sampled-texture' : 'sampler';\n  }\n}\n\nconst kCasesForMaxResourcesPerStageTests = params()\n  .combine(poptions('maxedType', kBindingTypes))\n  .combine(poptions('maxedVisibility', kShaderStages))\n  .filter(p => (kBindingTypeInfo[p.maxedType].validStages & p.maxedVisibility) !== 0)\n  .expand(function* (p) {\n    for (const extraTypeSame of [true, false]) {\n      yield* poptions('extraType', pickExtraBindingTypes(p.maxedType, extraTypeSame));\n    }\n  })\n  .combine(poptions('extraVisibility', kShaderStages))\n  .filter(p => (kBindingTypeInfo[p.extraType].validStages & p.extraVisibility) !== 0);\n\n// Should never fail unless kMaxBindingsPerBindGroup is exceeded, because the validation for\n// resources-of-type-per-stage is in pipeline layout creation.\ng.test('max_resources_per_stage,in_bind_group_layout')\n  .params(kCasesForMaxResourcesPerStageTests)\n  .fn(async t => {\n    const { maxedType, extraType, maxedVisibility, extraVisibility } = t.params;\n    const maxedTypeInfo = kBindingTypeInfo[maxedType];\n    const maxedCount = maxedTypeInfo.perStageLimitClass.max;\n    const extraTypeInfo = kBindingTypeInfo[extraType];\n\n    const maxResourceBindings: GPUBindGroupLayoutEntry[] = [];\n    for (let i = 0; i < maxedCount; i++) {\n      maxResourceBindings.push({\n        binding: i,\n        visibility: maxedVisibility,\n        type: maxedType,\n        storageTextureFormat: maxedTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n      });\n    }\n\n    const goodDescriptor = { entries: maxResourceBindings };\n\n    // Control\n    t.device.createBindGroupLayout(goodDescriptor);\n\n    const newDescriptor = clone(goodDescriptor);\n    newDescriptor.entries.push({\n      binding: maxedCount,\n      visibility: extraVisibility,\n      type: extraType,\n      storageTextureFormat: extraTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n    });\n\n    const shouldError = maxedCount >= kMaxBindingsPerBindGroup;\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout(newDescriptor);\n    }, shouldError);\n  });\n\n// One pipeline layout can have a maximum number of each type of binding *per stage* (which is\n// different for each type). Test that the max works, then add one more binding of same-or-different\n// type and same-or-different visibility.\ng.test('max_resources_per_stage,in_pipeline_layout')\n  .params(kCasesForMaxResourcesPerStageTests)\n  .fn(async t => {\n    const { maxedType, extraType, maxedVisibility, extraVisibility } = t.params;\n    const maxedTypeInfo = kBindingTypeInfo[maxedType];\n    const maxedCount = maxedTypeInfo.perStageLimitClass.max;\n    const extraTypeInfo = kBindingTypeInfo[extraType];\n\n    const maxResourceBindings: GPUBindGroupLayoutEntry[] = [];\n    for (let i = 0; i < maxedCount; i++) {\n      maxResourceBindings.push({\n        binding: i,\n        visibility: maxedVisibility,\n        type: maxedType,\n        storageTextureFormat: maxedTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n      });\n    }\n\n    const goodLayout = t.device.createBindGroupLayout({ entries: maxResourceBindings });\n\n    // Control\n    t.device.createPipelineLayout({ bindGroupLayouts: [goodLayout] });\n\n    const extraLayout = t.device.createBindGroupLayout({\n      entries: [\n        {\n          binding: 0,\n          visibility: extraVisibility,\n          type: extraType,\n          storageTextureFormat: extraTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n        },\n      ],\n    });\n\n    // Some binding types use the same limit, e.g. 'storage-buffer' and 'readonly-storage-buffer'.\n    const newBindingCountsTowardSamePerStageLimit =\n      (maxedVisibility & extraVisibility) !== 0 &&\n      kBindingTypeInfo[maxedType].perStageLimitClass.class ===\n        kBindingTypeInfo[extraType].perStageLimitClass.class;\n    const layoutExceedsPerStageLimit = newBindingCountsTowardSamePerStageLimit;\n\n    t.expectValidationError(() => {\n      t.device.createPipelineLayout({ bindGroupLayouts: [goodLayout, extraLayout] });\n    }, layoutExceedsPerStageLimit);\n  });\n"],"file":"createBindGroupLayout.spec.js"}