{"version":3,"sources":["../../../../src/webgpu/api/validation/fences.spec.ts"],"names":["description","makeTestGroup","assert","ValidationTest","g","test","fn","t","fence","queue","createFence","expectValidationError","promise","onCompletion","shouldReject","signal","initialValue","anotherDevice","device","adapter","requestDevice","anotherQueue","defaultQueue","expect","getCompletedValue"],"mappings":"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","sourcesContent":["export const description = `\nfences validation tests.\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { assert } from '../../../common/framework/util/util.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\n// TODO: Remove if https://github.com/gpuweb/gpuweb/issues/377 is decided\ng.test('wait_on_a_fence_without_signaling_the_value_is_invalid').fn(async t => {\n  const fence = t.queue.createFence();\n\n  t.expectValidationError(() => {\n    const promise = fence.onCompletion(2);\n    t.shouldReject('OperationError', promise);\n  });\n});\n\n// TODO: Remove if https://github.com/gpuweb/gpuweb/issues/377 is decided\ng.test('wait_on_a_fence_with_a_value_greater_than_signaled_value_is_invalid').fn(async t => {\n  const fence = t.queue.createFence();\n  t.queue.signal(fence, 2);\n\n  t.expectValidationError(() => {\n    const promise = fence.onCompletion(3);\n    t.shouldReject('OperationError', promise);\n  });\n});\n\ng.test('signal_a_value_lower_than_signaled_value_is_invalid').fn(async t => {\n  const fence = t.queue.createFence({ initialValue: 1 });\n\n  t.expectValidationError(() => {\n    t.queue.signal(fence, 0);\n  });\n});\n\ng.test('signal_a_value_equal_to_signaled_value_is_invalid').fn(async t => {\n  const fence = t.queue.createFence({ initialValue: 1 });\n\n  t.expectValidationError(() => {\n    t.queue.signal(fence, 1);\n  });\n});\n\ng.test('increasing_fence_value_by_more_than_1_succeeds').fn(async t => {\n  const fence = t.queue.createFence();\n\n  t.queue.signal(fence, 2);\n  await fence.onCompletion(2);\n\n  t.queue.signal(fence, 6);\n  await fence.onCompletion(6);\n});\n\ng.test('signal_a_fence_on_a_different_device_than_it_was_created_on_is_invalid').fn(async t => {\n  const fence = t.queue.createFence();\n\n  const anotherDevice = await t.device.adapter.requestDevice();\n  assert(anotherDevice !== null);\n  const anotherQueue = anotherDevice.defaultQueue;\n\n  t.expectValidationError(() => {\n    anotherQueue.signal(fence, 2);\n  });\n});\n\ng.test('signal_a_fence_on_a_different_device_does_not_update_fence_signaled_value').fn(async t => {\n  const fence = t.queue.createFence({ initialValue: 1 });\n\n  const anotherDevice = await t.device.adapter.requestDevice();\n  assert(anotherDevice !== null);\n  const anotherQueue = anotherDevice.defaultQueue;\n\n  t.expectValidationError(() => {\n    anotherQueue.signal(fence, 2);\n  });\n\n  t.expect(fence.getCompletedValue() === 1);\n\n  t.queue.signal(fence, 2);\n  await fence.onCompletion(2);\n});\n"],"file":"fences.spec.js"}