{"version":3,"sources":["../../../../src/webgpu/api/validation/createTexture.spec.ts"],"names":["description","poptions","makeTestGroup","kAllTextureFormats","kAllTextureFormatInfo","ValidationTest","F","getDescriptor","options","width","height","arrayLayerCount","mipLevelCount","sampleCount","format","size","depth","dimension","usage","GPUTextureUsage","OUTPUT_ATTACHMENT","SAMPLED","g","test","params","_success","fn","t","descriptor","expectValidationError","device","createTexture","texture","destroy","destroyBeforeEncode","destroyAfterEncode","textureView","createView","commandEncoder","createCommandEncoder","renderPass","beginRenderPass","colorAttachments","attachment","loadValue","r","b","a","endPass","commandBuffer","finish","queue","submit","info","renderable"],"mappings":"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","sourcesContent":["export const description = `\ncreateTexture validation tests.\n`;\n\nimport { poptions } from '../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { kAllTextureFormats, kAllTextureFormatInfo } from '../../capability_info.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nclass F extends ValidationTest {\n  getDescriptor(\n    options: {\n      width?: number;\n      height?: number;\n      arrayLayerCount?: number;\n      mipLevelCount?: number;\n      sampleCount?: number;\n      format?: GPUTextureFormat;\n    } = {}\n  ): GPUTextureDescriptor {\n    const {\n      width = 32,\n      height = 32,\n      arrayLayerCount = 1,\n      mipLevelCount = 1,\n      sampleCount = 1,\n      format = 'rgba8unorm',\n    } = options;\n    return {\n      size: { width, height, depth: arrayLayerCount },\n      mipLevelCount,\n      sampleCount,\n      dimension: '2d',\n      format,\n      usage: GPUTextureUsage.OUTPUT_ATTACHMENT | GPUTextureUsage.SAMPLED,\n    };\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('validation_of_sampleCount')\n  .params([\n    // TODO: Consider making a list of \"valid\"+\"invalid\" texture descriptors in capability_info.\n    { sampleCount: 0, _success: false }, // sampleCount of 0 is not allowed\n    { sampleCount: 1, _success: true }, // sampleCount of 1 is allowed\n    { sampleCount: 2, _success: false }, // sampleCount of 2 is not allowed\n    { sampleCount: 3, _success: false }, // sampleCount of 3 is not allowed\n    { sampleCount: 4, _success: true }, // sampleCount of 4 is allowed\n    { sampleCount: 8, _success: false }, // sampleCount of 8 is not allowed\n    { sampleCount: 16, _success: false }, // sampleCount of 16 is not allowed\n    { sampleCount: 4, mipLevelCount: 2, _success: false }, // multisampled multi-level not allowed\n    { sampleCount: 4, arrayLayerCount: 2, _success: false }, // multisampled multi-layer is not allowed\n  ])\n  .fn(async t => {\n    const { sampleCount, mipLevelCount, arrayLayerCount, _success } = t.params;\n\n    const descriptor = t.getDescriptor({ sampleCount, mipLevelCount, arrayLayerCount });\n\n    t.expectValidationError(() => {\n      t.device.createTexture(descriptor);\n    }, !_success);\n  });\n\ng.test('validation_of_mipLevelCount')\n  .params([\n    { width: 32, height: 32, mipLevelCount: 1, _success: true }, // mipLevelCount of 1 is allowed\n    { width: 32, height: 32, mipLevelCount: 0, _success: false }, // mipLevelCount of 0 is not allowed\n    { width: 32, height: 32, mipLevelCount: 6, _success: true }, // full mip chains are allowed (Mip level sizes: 32, 16, 8, 4, 2, 1)\n    { width: 31, height: 32, mipLevelCount: 6, _success: true }, // full mip chains are allowed (Mip level sizes: 31x32, 15x16, 7x8, 3x4, 1x2, 1x1)\n    { width: 32, height: 31, mipLevelCount: 6, _success: true }, // full mip chains are allowed (Mip level sizes: 32x31, 16x15, 8x7, 4x3, 2x1, 1x1)\n    { width: 31, height: 32, mipLevelCount: 7, _success: false }, // too big mip chains on width are disallowed (Mip level sizes: 31x32, 15x16, 7x8, 3x4, 1x2, 1x1, ?x?)\n    { width: 32, height: 31, mipLevelCount: 7, _success: false }, // too big mip chains on height are disallowed (Mip level sizes: 32x31, 16x15, 8x7, 4x3, 2x1, 1x1, ?x?)\n    { width: 32, height: 32, mipLevelCount: 100, _success: false }, // undefined shift check if miplevel is bigger than the integer bit width\n    { width: 32, height: 8, mipLevelCount: 6, _success: true }, // non square mip map halves the resolution until a 1x1 dimension. (Mip maps: 32 * 8, 16 * 4, 8 * 2, 4 * 1, 2 * 1, 1 * 1)\n  ])\n  .fn(async t => {\n    const { width, height, mipLevelCount, _success } = t.params;\n\n    const descriptor = t.getDescriptor({ width, height, mipLevelCount });\n\n    t.expectValidationError(() => {\n      t.device.createTexture(descriptor);\n    }, !_success);\n  });\n\ng.test('it_is_valid_to_destroy_a_texture').fn(t => {\n  const descriptor = t.getDescriptor();\n  const texture = t.device.createTexture(descriptor);\n  texture.destroy();\n});\n\ng.test('it_is_valid_to_destroy_a_destroyed_texture').fn(t => {\n  const descriptor = t.getDescriptor();\n  const texture = t.device.createTexture(descriptor);\n  texture.destroy();\n  texture.destroy();\n});\n\ng.test('it_is_invalid_to_submit_a_destroyed_texture_before_and_after_encode')\n  .params([\n    { destroyBeforeEncode: false, destroyAfterEncode: false, _success: true },\n    { destroyBeforeEncode: true, destroyAfterEncode: false, _success: false },\n    { destroyBeforeEncode: false, destroyAfterEncode: true, _success: false },\n  ])\n  .fn(async t => {\n    const { destroyBeforeEncode, destroyAfterEncode, _success } = t.params;\n\n    const descriptor = t.getDescriptor();\n    const texture = t.device.createTexture(descriptor);\n    const textureView = texture.createView();\n\n    if (destroyBeforeEncode) {\n      texture.destroy();\n    }\n\n    const commandEncoder = t.device.createCommandEncoder();\n    const renderPass = commandEncoder.beginRenderPass({\n      colorAttachments: [\n        {\n          attachment: textureView,\n          loadValue: { r: 1.0, g: 0.0, b: 0.0, a: 1.0 },\n        },\n      ],\n    });\n    renderPass.endPass();\n    const commandBuffer = commandEncoder.finish();\n\n    if (destroyAfterEncode) {\n      texture.destroy();\n    }\n\n    t.expectValidationError(() => {\n      t.queue.submit([commandBuffer]);\n    }, !_success);\n  });\n\ng.test('it_is_invalid_to_have_an_output_attachment_texture_with_non_renderable_format')\n  .params(poptions('format', kAllTextureFormats))\n  .fn(async t => {\n    const format: GPUTextureFormat = t.params.format;\n    const info = kAllTextureFormatInfo[format];\n\n    const descriptor = t.getDescriptor({ width: 1, height: 1, format });\n\n    t.expectValidationError(() => {\n      t.device.createTexture(descriptor);\n    }, !info.renderable);\n  });\n\n// TODO: Add tests for compressed texture formats\n"],"file":"createTexture.spec.js"}