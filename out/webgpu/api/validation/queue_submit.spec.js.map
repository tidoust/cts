{"version":3,"sources":["../../../../src/webgpu/api/validation/queue_submit.spec.ts"],"names":["description","makeTestGroup","ValidationTest","g","test","fn","t","buffer","device","createBuffer","size","usage","GPUBufferUsage","MAP_WRITE","COPY_SRC","targetBuffer","COPY_DST","getCommandBuffer","commandEncoder","createCommandEncoder","copyBufferToBuffer","finish","queue","submit","mapAsync","GPUMapMode","WRITE","expectValidationError","unmap"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;;CAArB,CAIP,SAASC,aAAT,QAA8B,yCAA9B;;AAEA,SAASC,cAAT,QAA+B,sBAA/B;;AAEA,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,cAAD,CAAvB;;AAEPC,CAAC,CAACC,IAAF,CAAO,+CAAP,EAAwDC,EAAxD,CAA2D,MAAMC,CAAN,IAAW;AACpE,QAAMC,MAAM,GAAGD,CAAC,CAACE,MAAF,CAASC,YAAT,CAAsB;AACnCC,IAAAA,IAAI,EAAE,CAD6B;AAEnCC,IAAAA,KAAK,EAAEC,cAAc,CAACC,SAAf,GAA2BD,cAAc,CAACE,QAFd,EAAtB,CAAf;;;AAKA,QAAMC,YAAY,GAAGT,CAAC,CAACE,MAAF,CAASC,YAAT,CAAsB;AACzCC,IAAAA,IAAI,EAAE,CADmC;AAEzCC,IAAAA,KAAK,EAAEC,cAAc,CAACI,QAFmB,EAAtB,CAArB;;;AAKA,QAAMC,gBAAgB,GAAG,MAAwB;AAC/C,UAAMC,cAAc,GAAGZ,CAAC,CAACE,MAAF,CAASW,oBAAT,EAAvB;AACAD,IAAAA,cAAc,CAACE,kBAAf,CAAkCb,MAAlC,EAA0C,CAA1C,EAA6CQ,YAA7C,EAA2D,CAA3D,EAA8D,CAA9D;AACA,WAAOG,cAAc,CAACG,MAAf,EAAP;AACD,GAJD;;AAMA;AACAf,EAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,CAACN,gBAAgB,EAAjB,CAAf;;AAEA;AACA,QAAMV,MAAM,CAACiB,QAAP,CAAgBC,UAAU,CAACC,KAA3B,CAAN;AACApB,EAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,EAAf;;AAEAjB,EAAAA,CAAC,CAACqB,qBAAF,CAAwB,MAAM;AAC5BrB,IAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,CAACN,gBAAgB,EAAjB,CAAf;AACD,GAFD;;AAIA;AACAV,EAAAA,MAAM,CAACqB,KAAP;AACAtB,EAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,CAACN,gBAAgB,EAAjB,CAAf;AACD,CA/BD","sourcesContent":["export const description = `\nqueue submit validation tests.\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('submitting_with_a_mapped_buffer_is_disallowed').fn(async t => {\n  const buffer = t.device.createBuffer({\n    size: 4,\n    usage: GPUBufferUsage.MAP_WRITE | GPUBufferUsage.COPY_SRC,\n  });\n\n  const targetBuffer = t.device.createBuffer({\n    size: 4,\n    usage: GPUBufferUsage.COPY_DST,\n  });\n\n  const getCommandBuffer = (): GPUCommandBuffer => {\n    const commandEncoder = t.device.createCommandEncoder();\n    commandEncoder.copyBufferToBuffer(buffer, 0, targetBuffer, 0, 4);\n    return commandEncoder.finish();\n  };\n\n  // Submitting when the buffer has never been mapped should succeed\n  t.queue.submit([getCommandBuffer()]);\n\n  // Map the buffer, submitting when the buffer is mapped (even with no getMappedRange) should fail\n  await buffer.mapAsync(GPUMapMode.WRITE);\n  t.queue.submit([]);\n\n  t.expectValidationError(() => {\n    t.queue.submit([getCommandBuffer()]);\n  });\n\n  // Unmap the buffer, queue submit should succeed\n  buffer.unmap();\n  t.queue.submit([getCommandBuffer()]);\n});\n"],"file":"queue_submit.spec.js"}