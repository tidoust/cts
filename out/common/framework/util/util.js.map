{"version":3,"sources":["../../../../src/common/framework/util/util.ts"],"names":["timeout","assert","condition","msg","Error","assertReject","p","unreachable","ex","perf","performance","require","now","resolveOnTimeout","ms","Promise","resolve","PromiseTimeoutError","rejectOnTimeout","_resolve","reject","raceWithRejectOnTimeout","race","objectEquals","x","y","constructor","Function","RegExp","valueOf","Array","isArray","length","Date","Object","x1","y1","keys","every","i","indexOf","range","n","fn","map","_"],"mappings":"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","sourcesContent":["import { timeout } from './timeout.js';\n\nexport function assert(condition: boolean, msg?: string | (() => string)): asserts condition {\n  if (!condition) {\n    throw new Error(msg && (typeof msg === 'string' ? msg : msg()));\n  }\n}\n\nexport async function assertReject(p: Promise<unknown>, msg?: string): Promise<void> {\n  try {\n    await p;\n    unreachable(msg);\n  } catch (ex) {\n    // Assertion OK\n  }\n}\n\nexport function unreachable(msg?: string): never {\n  throw new Error(msg);\n}\n\n// performance.now() is available in all browsers, but not in scope by default in Node.\nconst perf = typeof performance !== 'undefined' ? performance : require('perf_hooks').performance;\n\nexport function now(): number {\n  return perf.now();\n}\n\nexport function resolveOnTimeout(ms: number): Promise<void> {\n  return new Promise(resolve => {\n    timeout(() => {\n      resolve();\n    }, ms);\n  });\n}\n\nexport class PromiseTimeoutError extends Error {}\n\nexport function rejectOnTimeout(ms: number, msg: string): Promise<never> {\n  return new Promise((_resolve, reject) => {\n    timeout(() => {\n      reject(new PromiseTimeoutError(msg));\n    }, ms);\n  });\n}\n\nexport function raceWithRejectOnTimeout<T>(p: Promise<T>, ms: number, msg: string): Promise<T> {\n  return Promise.race([p, rejectOnTimeout(ms, msg)]);\n}\n\nexport function objectEquals(x: unknown, y: unknown): boolean {\n  if (typeof x !== 'object' || typeof y !== 'object') return x === y;\n  if (x === null || y === null) return x === y;\n  if (x.constructor !== y.constructor) return false;\n  if (x instanceof Function) return x === y;\n  if (x instanceof RegExp) return x === y;\n  if (x === y || x.valueOf() === y.valueOf()) return true;\n  if (Array.isArray(x) && Array.isArray(y) && x.length !== y.length) return false;\n  if (x instanceof Date) return false;\n  if (!(x instanceof Object)) return false;\n  if (!(y instanceof Object)) return false;\n\n  const x1 = x as { [k: string]: unknown };\n  const y1 = y as { [k: string]: unknown };\n  const p = Object.keys(x);\n  return Object.keys(y).every(i => p.indexOf(i) !== -1) && p.every(i => objectEquals(x1[i], y1[i]));\n}\n\nexport function range<T>(n: number, fn: (i: number) => T): T[] {\n  return [...new Array(n)].map((_, i) => fn(i));\n}\n"],"file":"util.js"}