{"version":3,"sources":["../../src/unittests/logger.spec.ts"],"names":["description","SkipTestCase","Logger","makeTestGroup","assert","UnitTest","g","test","fn","t","mylog","res1","record","res2","expect","results","get","logs","undefined","status","timems","rec","res","start","finish","debug","Error","skipped","warn","expectationFailed","validationFailed","threw","params","_logsCount","length"],"mappings":"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","sourcesContent":["export const description = `\nUnit tests for namespaced logging system.\n\nAlso serves as a larger test of async test functions, and of the logging system.\n`;\n\nimport { SkipTestCase } from '../common/framework/fixture.js';\nimport { Logger } from '../common/framework/logging/logger.js';\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { assert } from '../common/framework/util/util.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = makeTestGroup(UnitTest);\n\ng.test('construct').fn(t => {\n  const mylog = new Logger(true);\n  const [, res1] = mylog.record('one');\n  const [, res2] = mylog.record('two');\n\n  t.expect(mylog.results.get('one') === res1);\n  t.expect(mylog.results.get('two') === res2);\n  t.expect(res1.logs === undefined);\n  t.expect(res1.status === 'running');\n  t.expect(res1.timems < 0);\n  t.expect(res2.logs === undefined);\n  t.expect(res2.status === 'running');\n  t.expect(res2.timems < 0);\n});\n\ng.test('empty').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('pass').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.debug(new Error('hello'));\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('skip').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.skipped(new SkipTestCase());\n  rec.debug(new Error('hello'));\n  rec.finish();\n\n  t.expect(res.status === 'skip');\n  t.expect(res.timems >= 0);\n});\n\ng.test('warn').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.warn(new Error('hello'));\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'warn');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,expectationFailed').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.expectationFailed(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,validationFailed').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.validationFailed(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,threw').fn(t => {\n  const mylog = new Logger(true);\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.threw(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('debug')\n  .params([\n    { debug: true, _logsCount: 5 }, //\n    { debug: false, _logsCount: 3 },\n  ])\n  .fn(t => {\n    const { debug, _logsCount } = t.params;\n\n    const mylog = new Logger(debug);\n    const [rec, res] = mylog.record('one');\n\n    rec.start();\n    rec.debug(new Error('hello'));\n    rec.expectationFailed(new Error('bye'));\n    rec.warn(new Error());\n    rec.skipped(new SkipTestCase());\n    rec.debug(new Error('foo'));\n    rec.finish();\n\n    t.expect(res.status === 'fail');\n    t.expect(res.timems >= 0);\n    assert(res.logs !== undefined);\n    t.expect(res.logs.length === _logsCount);\n  });\n"],"file":"logger.spec.js"}